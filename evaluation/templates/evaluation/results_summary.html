{% extends 'base.html' %}
{% load dict_filters %}

{% block title %}Evaluation Results Summary{% endblock %}

{% block content %}
    <h2>Evaluation Results Summary</h2>

    <p>This table summarizes the NDCG scores for each experiment across different chunking strategies.</p>

    {% if results_data %}
        <table border="1" cellpadding="8" cellspacing="0" style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #f2f2f2;">
                    <th>ID</th>
                    <th>Document Title</th>
                    <th>Question</th>
                    {% for strategy in all_strategies %}
                        <th>{{ strategy.name }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in results_data %}
                    <tr>
                        <td style="text-align: center;">{{ row.experiment_id }}</td>
                        <td>{{ row.document_title }}</td>
                        <td>{{ row.question_text }}</td>
                        {% for strategy in all_strategies %}
                            <td style="text-align: center;">
                                {% with ndcg_score=row.strategy_results|get_item:strategy.name %}
                                    {% if ndcg_score is not None %}
                                        <strong>{{ ndcg_score|floatformat:4 }}</strong>
                                    {% else %}
                                        <span style="color: gray;">N/A</span>
                                    {% endif %}
                                {% endwith %}
                            </td>
                        {% endfor %}
                    </tr>
                {% empty %}
                    <tr><td colspan="{{ all_strategies|length |add:3 }}" style="text-align: center; color: orange;">No evaluation results found. Please run analyses first.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No evaluation results available yet. Please conduct some experiments and run retrieval simulations.</p>
    {% endif %}

    <p style="margin-top: 20px;">
        <a href="{% url 'dashboard' %}">Back to Dashboard</a>
    </p>
{% endblock %}